<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1"
    />
    <title>çŒ«å’ªå åœæœº Â· Cat Oracle</title>

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      // Tailwind è‡ªå®šä¹‰ä¸»é¢˜ï¼ˆæŸ”å’Œé…è‰²ï¼‰
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: [
                "system-ui",
                "-apple-system",
                "BlinkMacSystemFont",
                "Segoe UI",
                "sans-serif",
              ],
            },
            colors: {
              catbg: "#f8fafc",
              catCard: "#ffffff",
              catAccent: "#fbbf24",
              catAccentSoft: "#fde68a",
              catTextSoft: "#64748b",
            },
            boxShadow: {
              cat: "0 18px 45px rgba(15,23,42,0.15)",
            },
          },
        },
      };
    </script>

    <style>
      /* çŒ«å’ªè½»å¾®å‘¼å¸åŠ¨ç”» */
      @keyframes cat-breathe {
        0% {
          transform: translateY(0) scale(1);
        }
        50% {
          transform: translateY(-4px) scale(1.03);
        }
        100% {
          transform: translateY(0) scale(1);
        }
      }

      /* è½»å¾®æŠ–åŠ¨ï¼Œç”¨äºåç»­äº¤äº’ï¼ˆå…ˆé¢„ç•™ï¼‰ */
      @keyframes cat-shake-soft {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-3px);
        }
        50% {
          transform: translateX(3px);
        }
        75% {
          transform: translateX(-2px);
        }
      }

      .cat-breathe {
        animation: cat-breathe 3s ease-in-out infinite;
        transform-origin: center bottom;
      }

      /* è½»å¾®æŠ–åŠ¨ï¼šçŸ­ä¿ƒçš„å‘¼å™œåé¦ˆ */
      .cat-shake {
        animation: cat-shake-soft 260ms ease-in-out;
      }

      /* ç»“æœç™½å…‰é®ç½© */
      @keyframes cat-flash {
        0% {
          opacity: 0;
        }
        45% {
          opacity: 1;
        }
        100% {
          opacity: 0;
        }
      }

      .flash-active {
        animation: cat-flash 650ms ease-out;
      }

      /* ç­”æ¡ˆå¡ç‰‡æ‰è½ + å¼¹è·³ */
      @keyframes card-drop-bounce {
        0% {
          transform: translate3d(0, -40vh, 0) scale(0.9) rotate(-3deg);
          opacity: 0;
        }
        40% {
          transform: translate3d(0, 6%, 0) scale(1) rotate(1deg);
          opacity: 1;
        }
        62% {
          transform: translate3d(0, -4%, 0) scale(1.01) rotate(-1deg);
        }
        78% {
          transform: translate3d(0, 0%, 0) scale(1) rotate(0deg);
        }
        100% {
          transform: translate3d(0, 0%, 0) scale(1) rotate(0deg);
          opacity: 1;
        }
      }

      .card-enter {
        animation: card-drop-bounce 700ms cubic-bezier(0.22, 0.68, 0, 1.02)
          forwards;
      }

      /* ç²’å­ï¼šé£˜èµ·çš„å°æ˜Ÿæ˜Ÿ / è‚‰å« */
      @keyframes particle-pop {
        0% {
          transform: translate3d(0, 0, 0) scale(0.6);
          opacity: 0;
        }
        15% {
          opacity: 1;
        }
        100% {
          transform: translate3d(var(--dx, 0px), var(--dy, -36px), 0)
            scale(1.1);
          opacity: 0;
        }
      }

      .particle {
        position: absolute;
        font-size: 14px;
        pointer-events: none;
        animation: particle-pop 600ms ease-out forwards;
        will-change: transform, opacity;
      }

      /* è¯¦æƒ…è¡Œå±•å¼€ / æ”¶èµ·è¿‡æ¸¡ */
      .answer-detail-transition {
        transition: opacity 260ms ease-out, max-height 260ms ease-out,
          margin-top 260ms ease-out;
        overflow: hidden;
      }

      .answer-detail-collapsed {
        opacity: 0;
        max-height: 0;
        margin-top: 0;
      }

      .answer-detail-expanded {
        opacity: 1;
        max-height: 200px;
        margin-top: 0.25rem; /* ä¸ Tailwind çš„ mt-1 æ¥è¿‘ */
      }

      /* çŒ«å›¾å®¹å™¨ï¼šå•å¼ å›¾ç‰‡ï¼Œè‡ªé€‚åº”ç§»åŠ¨ç«¯ */
      .cat-figure {
        position: relative;
        width: 72vw;
        max-width: 260px;
        aspect-ratio: 1 / 1;
        margin: 0 auto;
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        border-radius: 26%;
        box-shadow: 0 18px 45px rgba(15, 23, 42, 0.14);
      }
    </style>
  </head>

  <body
    class="min-h-screen flex flex-col bg-gradient-to-b from-[#fff7ed] via-[#fff1f2] to-[#fef3c7]"
  >
    <!-- æ•´ä½“å®¹å™¨ï¼šå‚ç›´å±…ä¸­ -->
    <main
      class="flex-1 flex flex-col items-center justify-center px-6 pb-28 pt-10"
    >
      <!-- æ ‡é¢˜ä¸è¯´æ˜ -->
      <section class="text-center mb-8">
        <h1 class="text-2xl font-semibold text-slate-800 mb-2">
          çŒ«å’ªå åœæœº
        </h1>
        <p class="text-sm text-catTextSoft">
          ç”¨æ‰‹è½»è½»åœ°ã€è€å¿ƒåœ°æ‘¸çŒ«ï¼Œç­‰çŒ«å’ªæ”’å¤Ÿäº†èƒ½é‡ï¼Œå°±ä¼šç»™ä½ ä¸€æ¡å¸¦çŒ«å‘³çš„ç­”æ¡ˆã€‚
        </p>
      </section>

      <!-- çŒ«å’ªäº’åŠ¨åŒºåŸŸ -->
      <section
        id="cat-area"
        class="relative w-full max-w-xs sm:max-w-sm aspect-square mx-auto select-none"
      >
        <div
          id="cat-hit-area"
          class="w-full h-full rounded-3xl bg-gradient-to-b from-[#fff7ed] to-[#fed7aa] shadow-cat flex items-center justify-center overflow-hidden cursor-pointer"
        >
          <!-- ç²¾çµå›¾æ©˜çŒ« -->
          <div
            id="cat-figure"
            class="cat-figure cat-breathe"
            aria-label="ä¸€åªæ­£åœ¨æ‰“ç›¹çš„æ©˜çŒ«"
          ></div>
        </div>

        <!-- ç»“æœç™½å…‰é®ç½© -->
        <div
          id="result-flash"
          class="pointer-events-none absolute inset-0 rounded-3xl bg-white"
          style="opacity: 0"
        ></div>

        <!-- ç­”æ¡ˆå¡ç‰‡ -->
        <div
          id="answer-card"
          class="invisible opacity-0 fixed inset-0 z-30 flex items-center justify-center transition-opacity duration-300"
        >
          <div
            id="answer-card-inner"
            class="w-[88vw] max-w-sm bg-white/70 backdrop-blur-[10px] rounded-[26px] border border-white/60 shadow-[0_24px_60px_rgba(15,23,42,0.35)] px-6 py-5 sm:px-7 sm:py-6"
          >
            <div
              id="answer-type-pill"
              class="inline-flex items-center justify-center rounded-full px-3 py-1 text-[11px] font-medium mb-2 mx-auto bg-white/60 text-slate-800"
            >
              çŒ«å’ªæ­£åœ¨æ€è€ƒâ€¦
            </div>
            <p
              id="answer-main"
              class="text-lg sm:text-2xl font-semibold text-slate-800 mb-3 leading-snug"
            >
              â€¦
            </p>
            <p
              id="answer-detail"
              class="answer-detail-transition answer-detail-collapsed text-sm sm:text-base text-slate-700/80 leading-relaxed"
            >
              ç­‰çŒ«å’ªç»™ä½ ä¸€ä¸ªæ­£å¼çš„ç­”æ¡ˆã€‚
            </p>
            <button
              id="answer-dismiss"
              type="button"
              class="mt-4 inline-flex items-center justify-center px-4 py-2 rounded-full text-xs sm:text-sm font-medium bg-amber-300/90 text-slate-800 hover:bg-amber-400 active:scale-95 transition transform duration-150 shadow-sm"
            >
              æ”¶å¥½è¿™æ¡çŒ«å¼å»ºè®®
            </button>
          </div>
        </div>

        <!-- è½»å¾®çš„æç¤ºæ–‡å­— -->
        <p
          class="absolute -bottom-8 left-1/2 -translate-x-1/2 text-xs text-catTextSoft"
        >
          åœ¨çŒ«èº«ä¸Šæ¥å›æ»‘åŠ¨ / è½»æŠš
        </p>
      </section>
    </main>

    <!-- åº•éƒ¨éšè—è‚‰å«è¿›åº¦æ¡ -->
    <footer
      class="fixed inset-x-0 bottom-0 px-5 pb-6 pt-3 bg-gradient-to-t from-white/90 via-white/80 to-transparent backdrop-blur-sm"
    >
      <div
        id="progress-wrapper"
        class="max-w-md mx-auto opacity-0 translate-y-3 transition-all duration-500"
      >
        <div class="flex items-center justify-between mb-1">
          <span class="text-xs font-medium text-slate-700">çŒ«å’ªèƒ½é‡</span>
          <span
            id="progress-label"
            class="text-[11px] text-catTextSoft tracking-wide"
            >æ‘¸ä¸€æ‘¸è¯•è¯•çœ‹</span
          >
        </div>

        <!-- è‚‰å«æ§½ -->
        <div
          class="relative h-4 rounded-full bg-slate-200/80 overflow-hidden shadow-inner"
        >
          <!-- èƒŒæ™¯è‚‰å«çº¹ç†ï¼ˆç®€å•ç‰ˆï¼šæ¸å˜ï¼‰ -->
          <div
            class="absolute inset-0 bg-[radial-gradient(circle_at_10%_50%,#fecaca_0,#fecaca_28%,transparent_30%),radial-gradient(circle_at_35%_50%,#fed7aa_0,#fed7aa_26%,transparent_30%),radial-gradient(circle_at_60%_50%,#fed7aa_0,#fed7aa_26%,transparent_30%),radial-gradient(circle_at_85%_50%,#fecaca_0,#fecaca_28%,transparent_30%)] opacity-60 pointer-events-none"
          ></div>

          <!-- è¿›åº¦æ¡ä¸»ä½“ -->
          <div
            id="progress-bar"
            class="absolute inset-y-0 left-0 w-0 bg-gradient-to-r from-amber-300 via-amber-400 to-amber-500 rounded-full transition-[width] duration-300 ease-out"
          ></div>
        </div>

        <!-- å°æç¤º paw -->
        <div class="mt-1.5 flex items-center justify-end gap-1">
          <span class="text-[10px] text-catTextSoft">è‚‰å«å……èƒ½ä¸­</span>
          <span class="text-xs">ğŸ¾</span>
        </div>
      </div>
    </footer>

    <!-- é¢„ç•™éŸ³é¢‘æ¥å£ -->
    <audio id="audio-purr" src="purr.mp3" preload="auto"></audio>
    <audio id="audio-meow" src="meow.mp3" preload="auto"></audio>
    <audio id="audio-paper" src="paper.mp3" preload="auto"></audio>

    <!-- æ ¸å¿ƒè„šæœ¬ï¼šèƒ½é‡è¿›åº¦é€»è¾‘ & ç­”æ¡ˆåº“ -->
    <script>
      // åœºæ™¯åŒ–çŒ«å’ªç­”æ¡ˆåº“ï¼šå…ˆéšæœºåœºæ™¯ï¼Œå†ä»è¯¥åœºæ™¯å†…æŠ½æ–‡æ¡ˆ
      const catScenes = [
        {
          id: 1,
          img: "cat1.png",
          action: "å¤§å£å¹²é¥­ä¸­...",
          options: [
            {
              text: "å…ˆçŠ’åŠ³ä¸‹è‡ªå·±ï¼",
              detail: "æ²¡ä»€ä¹ˆäº‹æ˜¯ä¸€ä¸ªç½å¤´è§£å†³ä¸äº†çš„ã€‚",
            },
            {
              text: "èƒƒæ¯”å¿ƒæ›´éœ€è¦å¡«æ»¡ã€‚",
              detail: "åƒé¥±äº†æ‰æœ‰åŠ›æ°”å»åº”ä»˜éº»çƒ¦çš„äººç±»ã€‚",
            },
            {
              text: "å¥½è¿æ­£åœ¨æ´¾é€",
              detail: "çŒ«ç²®æ€»æ˜¯å‡†æ—¶æ‰è½ã€‚",
            },
          ],
        },
        {
          id: 2,
          img: "cat2.png",
          action: "ä¼˜é›…æ‹‰ä¼¸ä¸­...",
          options: [
            {
              text: "èˆ’å±•ä¸€ä¸‹",
              detail: "åˆ«æŠŠè‡ªå·±å´©å¾—å¤ªç´§ï¼Œä¼¸ä¸ªé•¿é•¿çš„æ‡’è…°å§ã€‚",
            },
            {
              text: "æ¢ä¸ªå§¿åŠ¿çœ‹ä¸–ç•Œã€‚",
              detail: "ç«™å¾—é«˜ã€ä¼¸å¾—é•¿ï¼Œçƒ¦æ¼é€šé€šå˜å°ã€‚",
            },
            {
              text: "ä¸‹ä¸€æ­¥å°±æ˜¯é£æ‰‘ï¼",
              detail: "æ”¾æ¾æ˜¯ä¸ºäº†æ›´å¥½çš„å‡ºå‡»",
            },
          ],
        },
        {
          id: 3,
          img: "cat3.png",
          action: "ç©ºä¸­é£çŒ«ï¼",
          options: [
            {
              text: "å‘ç°ç›®æ ‡ï¼",
              detail: "åˆ«çŠ¹è±«ï¼è¸©çº¢ç‚¹ï¼",
            },
            {
              text: "æŒ‰ç…§ç›´è§‰ç‹‚å¥”ã€‚",
              detail: "èº«ä½“ä¼šå¤§è„‘å…ˆåˆ°è¾¾ç›®çš„åœ°ã€‚",
            },
            {
              text: "å“ªæ€•æ‰‘ç©ºäº†ï¼Œå§¿åŠ¿ä¹Ÿè¦å¸…ã€‚",
              detail: "å‹‡æ•¢è·³è·ƒï¼Œè‡ªå¸¦é—ªå…‰ç¯ã€‚",
            },
          ],
        },
        {
          id: 4,
          img: "cat4.png",
          action: "æ­»æ­»æŠ±ä½å°é±¼å¹²",
          options: [
            {
              text: "è¿™äº‹ç¨³å¾—åƒæ€€é‡Œçš„é±¼ã€‚",
              detail: "è°ä¹Ÿåˆ«æƒ³æŠ¢èµ°ä½ çš„æœºä¼šã€‚",
            },
            {
              text: "ä¸éœ€è¦æ„Ÿåˆ°æŠ±æ­‰ã€‚",
              detail: "å¿ƒå®‰ç†å¾—åœ°äº«å—æˆ˜åˆ©å“ã€‚",
            },
            {
              text: "ä½ å·²ç»æ‹¥æœ‰æœ€å¥½çš„äº†ã€‚",
              detail: "æŠ±åœ¨æ€€é‡Œï¼Œåƒå®šæ€€é‡Œã€‚",
            },
          ],
        },
        {
          id: 5,
          img: "cat5.png",
          action: "ç›¯ç€ç”µè„‘æ€è€ƒï¼ˆæˆ–å‘å‘†ï¼‰",
          options: [
            {
              text: "ç­”æ¡ˆå°±åœ¨ä½ å¿ƒé‡Œã€‚",
              detail: "æœç´¢æ¡†æœä¸åˆ°ä½ æƒ³è¦çš„å†³å¿ƒã€‚",
            },
            {
              text: "è¿™ä¸å€¼å¾—ä½ æµªè´¹ä¸€æ¬¡åˆç¡ã€‚",
              detail: "æœ‰äº›å¹²æ‰°åªæ˜¯å±å¹•ä¸Šçš„å°è™«å­",
            },
            {
              text: "è¯·æŒ‰å…µä¸åŠ¨ã€‚",
              detail: "æœ€é«˜ç«¯çš„çŒæ‰‹å¾€å¾€ä»¥çŒç‰©çš„å½¢å¼å‡ºç°",
            },
          ],
        },
        {
          id: 6,
          img: "cat6.png",
          action: "ä¸€è„¸ä¸¥è‚ƒåœ°ç”¨åŠ›ä¸­...",
          options: [
            {
              text: "æœ‰äº›ä¸æ„‰å¿«çš„å°±æŠŠå®ƒåŸ‹äº†å§ã€‚",
              detail: "æ©åŸ‹è¿‡å»æ˜¯ä¸ºäº†æ¸…æ–°çš„æ˜å¤©ã€‚",
            },
            {
              text: "åŠªåŠ›åä¼šæœ‰å‰æ‰€æœªæœ‰çš„è½»æ¾ã€‚",
              detail: "æŠŠå‹åŠ›æ’æ³„æ‰ï¼Œç”Ÿæ´»éƒ½è½»äº†ã€‚",
            },
            {
              text: "æ”¾ä¸‹åŒ…è¢±ï¼Œä¼˜é›…å‰è¡Œã€‚",
              detail: "è…¾å‡ºç©ºé—´æ‰èƒ½è£…ä¸‹æ›´å¤šçŒ«ç½å¤´ã€‚",
            },
          ],
        },
        {
          id: 7,
          img: "cat7.png",
          action: "å¥½å¥‡åœ°é’»è¿›åŒ…åŒ…/å‡†å¤‡å‡ºå‘",
          options: [
            {
              text: "é’»è¿›å®‰å…¨åŒºã€‚",
              detail: "æš‚æ—¶èº²é¿ä¸€ä¸‹å¹¶ä¸å¯è€»ã€‚",
            },
            {
              text: "æœªçŸ¥çš„å†’é™©å³å°†å¼€å§‹ã€‚",
              detail: "å¤–é¢çš„ç©ºæ°”å¾ˆæ–°é²œã€‚",
            },
            {
              text: "æ¢ä¸ªç¯å¢ƒï¼Œå¥½è¿å°±ä¼šå‘ç”Ÿã€‚",
              detail: "åˆ°å¤„éƒ½æ˜¯çŒ«è–„è·ã€‚",
            },
          ],
        },
      ];

      // æ—§ç»“æ„ä¿ç•™ä½†ä¸å†ä½¿ç”¨ï¼Œåç»­é€»è¾‘å…¨éƒ¨åˆ‡åˆ° catScenes
      const catAnswers = [
        // ç™½çŒ« - æ¸©æŸ”ç±»
        {
          cat: "white",
          text: "è¹­è¹­ä½ ï¼Œä¸€åˆ‡éƒ½ä¼šå¥½èµ·æ¥çš„ã€‚",
          detail: "æœ‰æ—¶å€™åœä¸‹æ¥é—­ä¸Šçœ¼ï¼Œå°±èƒ½æ„Ÿå—åˆ°é˜³å…‰çš„æ¸©åº¦ã€‚",
        },
        {
          cat: "white",
          text: "ä½ åœ¨å‘å…‰ï¼Œåªæ˜¯ä½ è‡ªå·±æ²¡å¯Ÿè§‰ã€‚",
          detail: "å°±åƒç™½è‰²çš„æ¯›å‘åœ¨æœˆå…‰ä¸‹ä¸€æ ·ï¼Œä½ ä¹Ÿå¾ˆè€€çœ¼ã€‚",
        },

        // ç°çŒ« - ç†æ€§ç±»
        {
          cat: "gray",
          text: "è§‚å¯Ÿï¼Œç„¶åç­‰å¾…æ—¶æœºã€‚",
          detail: "åœ¨è·³è·ƒä¹‹å‰ï¼ŒçŒ«æ€»æ˜¯ä¼šå…ˆæ™ƒåŠ¨å±è‚¡ç„å‡†å¾ˆä¹…ã€‚",
        },
        {
          cat: "gray",
          text: "è¿™ä¸å€¼å¾—ä½ æµªè´¹ä¸€æ¬¡åˆç¡ã€‚",
          detail: "æœ‰äº›å¹²æ‰°åªæ˜¯çª—å¤–çš„éº»é›€ï¼Œçœ‹ä¸€çœ¼å°±å¤Ÿäº†ã€‚",
        },

        // æ©˜çŒ« - ä¹è§‚ç±»
        {
          cat: "orange",
          text: "å¤§æ©˜ä¸ºé‡ï¼Œå…ˆåƒé¥±å†è¯´ï¼",
          detail: "è‚šå­å¡«æ»¡äº†ï¼Œå¿ƒé‡Œçš„çƒ¦æ¼å°±æŒ¤ä¸å‡ºä½ç½®äº†ã€‚",
        },
        {
          cat: "orange",
          text: "ç”Ÿæ´»å°±åƒç½å¤´ï¼Œæ€»æœ‰æ‰“å¼€çš„åŠæ³•ã€‚",
          detail: "åªè¦ä½ å¤ŸåŠªåŠ›ï¼ˆæˆ–è€…å«å¾—å¤Ÿå¤§å£°ï¼‰ï¼Œæ€»ä¼šæœ‰æ”¶è·ã€‚",
        },

        // é»‘çŒ« - é…·é…·ç±»
        {
          cat: "black",
          text: "æˆ‘å°±åœ¨é»‘æš—é‡Œçœ‹ç€ä½ æŠ˜è…¾ã€‚",
          detail: "åˆ«è£…äº†ï¼Œå…¶å®ä½ å¿ƒé‡Œæ—©å°±æœ‰ç­”æ¡ˆäº†ï¼Œå¯¹å§ï¼Ÿ",
        },
        {
          cat: "black",
          text: "å“ˆæ°”ï¼ç¦»é‚£ä¸ªçƒ‚äººè¿œç‚¹ã€‚",
          detail: "æˆ‘çš„ç›´è§‰ä»æ²¡é”™è¿‡ï¼Œä½ çš„ä¹Ÿä¸€æ ·ã€‚",
        },
      ];

      // ç®€å•çŠ¶æ€ç®¡ç†
      const catArea = document.getElementById("cat-area");
      const catHitArea = document.getElementById("cat-hit-area");
      const catFigure = document.getElementById("cat-figure");
      const progressWrapper = document.getElementById("progress-wrapper");
      const progressBar = document.getElementById("progress-bar");
      const progressLabel = document.getElementById("progress-label");
      const resultFlash = document.getElementById("result-flash");
      const answerCard = document.getElementById("answer-card");
      const answerCardInner = document.getElementById("answer-card-inner");
      const answerTypePill = document.getElementById("answer-type-pill");
      const answerMain = document.getElementById("answer-main");
      const answerDetail = document.getElementById("answer-detail");
      const answerDismiss = document.getElementById("answer-dismiss");

      const audioPurr = document.getElementById("audio-purr");
      const audioMeow = document.getElementById("audio-meow");
      const audioPaper = document.getElementById("audio-paper");

      let energy = 0; // 0 - 100
      let hasStarted = false;
      let lastPointerPos = null;
      let resultShown = false;
      let particleId = 0;
      let currentScene = null;
      let isDetailRevealed = false;

      const MAX_ENERGY = 100;
      const ENERGY_PER_STROKE_UNIT = 0.08; // æ‰‹æŒ‡/é¼ æ ‡ç§»åŠ¨è·ç¦»å¯¹èƒ½é‡çš„å½±å“

      function revealProgressBar() {
        if (!hasStarted) {
          hasStarted = true;
          progressWrapper.classList.remove("opacity-0", "translate-y-3");
          progressWrapper.classList.add("opacity-100", "translate-y-0");
        }
      }

      function setEnergy(value) {
        const clamped = Math.max(0, Math.min(MAX_ENERGY, value));
        energy = clamped;

        const percentage = (clamped / MAX_ENERGY) * 100;
        progressBar.style.width = percentage + "%";

        if (clamped === 0) {
          progressLabel.textContent = "æ‘¸ä¸€æ‘¸è¯•è¯•çœ‹";
        } else if (clamped < 30) {
          progressLabel.textContent = "çŒ«å’ªåˆšåˆšé†’ï¼Œè¿˜åœ¨æ‰“å“ˆæ¬ â€¦";
        } else if (clamped < 70) {
          progressLabel.textContent = "å‘¼å™œå£°æ¸æ¸å˜å¤§äº†â€¦";
        } else if (clamped < MAX_ENERGY) {
          progressLabel.textContent = "å†å¤šæ‘¸ä¸€ä¼šå„¿ï¼Œé©¬ä¸Šå°±è¦å›ç­”ä½ äº†ï¼";
        } else {
          progressLabel.textContent = "çŒ«å’ªèƒ½é‡å·²æ»¡ï¼";
          if (!resultShown) {
            triggerResultSequence();
          }
        }
      }

      // ç²’å­ç‰¹æ•ˆï¼šåœ¨çŒ«å’ªåŒºåŸŸç”Ÿæˆä¸€å°æ’®æ˜Ÿæ˜Ÿ / è‚‰å«
      function spawnParticle(clientX, clientY) {
        const rect = catHitArea.getBoundingClientRect();
        const x = clientX - rect.left;
        const y = clientY - rect.top;

        const particle = document.createElement("span");
        particle.className = "particle";
        particle.style.left = x + "px";
        particle.style.top = y + "px";

        const dx = (Math.random() - 0.5) * 26;
        const dy = -20 - Math.random() * 20;
        particle.style.setProperty("--dx", dx + "px");
        particle.style.setProperty("--dy", dy + "px");

        const variants = ["ğŸ¾", "ğŸ¾", "ğŸ¾"];
        particle.textContent =
          variants[(particleId++ + variants.length) % variants.length];

        catHitArea.appendChild(particle);

        setTimeout(() => {
          particle.remove();
        }, 700);
      }

      function softShakeCat() {
        if (!catFigure) return;
        catFigure.classList.add("cat-shake");
        setTimeout(() => {
          catFigure.classList.remove("cat-shake");
        }, 260);
      }

      // éšæœºé€‰æ‹©ä¸€ä¸ªåœºæ™¯ï¼Œå¹¶å±•ç¤ºå¯¹åº”çš„çŒ«å›¾
      function setRandomCatScene() {
        if (!catFigure) return;
        if (!catScenes || catScenes.length === 0) return;
        const index = Math.floor(Math.random() * catScenes.length);
        currentScene = catScenes[index];
        catFigure.style.backgroundImage = "url('" + currentScene.img + "')";
        catFigure.style.backgroundSize = "contain";
        catFigure.style.backgroundPosition = "center";
        catFigure.style.backgroundRepeat = "no-repeat";
      }

      function playSafe(audioEl) {
        if (!audioEl) return;
        const playPromise = audioEl.play();
        if (playPromise && typeof playPromise.catch === "function") {
          playPromise.catch(() => {});
        }
      }

      // ä»æŒ‡å®šåœºæ™¯ä¸­éšæœºé€‰æ‹©ä¸€æ¡æ–‡æ¡ˆ
      function pickRandomOption(scene) {
        if (!scene || !scene.options || scene.options.length === 0) return null;
        const idx = Math.floor(Math.random() * scene.options.length);
        return scene.options[idx];
      }

      function showAnswerCard(scene, option) {
        if (!scene || !option) return;
        resultShown = true;
        isDetailRevealed = false;

        // é¡¶éƒ¨çŠ¶æ€æ ‡ç­¾ï¼šç›´æ¥ä½¿ç”¨åœºæ™¯è¡Œä¸ºè¯­ï¼Œå±…ä¸­èƒ¶å›Šæ˜¾ç¤º
        answerTypePill.textContent = scene.action || "å¿™ç¢Œä¸­...";
        answerTypePill.className =
          "inline-flex items-center justify-center rounded-full px-3 py-1 text-[11px] font-medium mb-2 mx-auto bg-white/60 text-slate-800";

        // ä¸»æ–‡æ¡ˆï¼šåŠ ç²—å¤§æ ‡é¢˜
        answerMain.textContent = option.text || "çŒ«å’ªè¿˜åœ¨è€ƒè™‘ä¸­...";

        // è¯¦æƒ…æ–‡æ¡ˆï¼šå…ˆå†™å…¥æ–‡æœ¬ï¼Œä½†ä¿æŒæŠ˜å çŠ¶æ€ï¼Œç­‰å¾…ç¬¬äºŒæ­¥ç‚¹å‡»å±•å¼€
        answerDetail.textContent =
          option.detail || "å†å¤šæ‘¸ä¸€ä¼šå„¿ï¼Œè¯´ä¸å®šå°±æœ‰ç­”æ¡ˆã€‚";
        answerDetail.classList.remove("answer-detail-expanded");
        answerDetail.classList.add("answer-detail-transition");
        answerDetail.classList.add("answer-detail-collapsed");

        // ç¬¬ä¸€æ­¥æŒ‰é’®å¯è§
        answerDismiss.classList.remove("hidden");

        // æ˜¾ç¤ºæ•´ä½“é®ç½©
        answerCard.classList.remove("invisible");
        answerCard.classList.remove("opacity-0");

        // è§¦å‘å¡ç‰‡æ‰è½åŠ¨ç”»
        if (!answerCardInner) return;
        answerCardInner.classList.remove("card-enter");
        void answerCardInner.offsetWidth; // å¼ºåˆ¶ reflow
        answerCardInner.classList.add("card-enter");

        playSafe(audioMeow);
        setTimeout(() => {
          playSafe(audioPaper);
        }, 120);
      }

      function hideAnswerCard() {
        answerCard.classList.add("opacity-0");
        setTimeout(() => {
          answerCard.classList.add("invisible");
        }, 220);
        resultShown = false;
        isDetailRevealed = false;
        // é‡ç½®è¿›åº¦æ¡ï¼Œå‡†å¤‡ä¸‹ä¸€æ¬¡å åœ
        setEnergy(0);
        // æ¢ä¸€åªçŒ«ï¼Œå¼€å§‹ä¸‹ä¸€è½®å åœ
        setRandomCatScene();
      }

      function triggerResultSequence() {
        // ç™½å…‰é—ªä¸€ä¸‹
        resultFlash.classList.remove("flash-active");
        void resultFlash.offsetWidth;
        resultFlash.classList.add("flash-active");

        // å‘¼å™œéœ‡åŠ¨
        softShakeCat();
        playSafe(audioPurr);

        const option = pickRandomOption(currentScene);

        // ç¨å¾®ç­‰ä¸€ä¸‹ç™½å…‰å³°å€¼ï¼Œå†æ‰å¡ç‰‡
        setTimeout(() => {
          showAnswerCard(currentScene, option);
        }, 260);
      }

      function revealDetail() {
        if (isDetailRevealed) return;
        isDetailRevealed = true;
        answerDetail.classList.remove("answer-detail-collapsed");
        answerDetail.classList.add("answer-detail-expanded");
        // ç¬¬äºŒæ­¥å±•å¼€åï¼ŒæŒ‰é’®æ·¡å‡ºéšè—ï¼Œç”±ç”¨æˆ·ç‚¹å‡»å¡ç‰‡å¤–éƒ¨æ¥ç»“æŸæœ¬è½®å åœ
        answerDismiss.classList.add("hidden");
      }

      function handlePointerMove(clientX, clientY) {
        revealProgressBar();

        const rect = catHitArea.getBoundingClientRect();
        // åªåœ¨å‘½ä¸­åŒºåŸŸå†…æ‰ç®—â€œæ‘¸çŒ«â€
        if (
          clientX < rect.left ||
          clientX > rect.right ||
          clientY < rect.top ||
          clientY > rect.bottom
        ) {
          lastPointerPos = null;
          return;
        }

        const current = { x: clientX, y: clientY };

        if (lastPointerPos) {
          const dx = current.x - lastPointerPos.x;
          const dy = current.y - lastPointerPos.y;
          const distance = Math.sqrt(dx * dx + dy * dy);

          if (distance > 0) {
            const gain = distance * ENERGY_PER_STROKE_UNIT;
            setEnergy(energy + gain);
          }
        }

        lastPointerPos = current;

        // æ¯æ¬¡æœ‰æ•ˆæŠšæ‘¸æ—¶å¶å°”ç”Ÿæˆä¸€ä¸ªå°ç²’å­
        if (Math.random() < 0.35) {
          spawnParticle(clientX, clientY);
        }
      }

      // é¼ æ ‡äº‹ä»¶
      let isMouseDown = false;

      catHitArea.addEventListener("mousedown", (e) => {
        isMouseDown = true;
        lastPointerPos = { x: e.clientX, y: e.clientY };
        revealProgressBar();
        softShakeCat();
        playSafe(audioPurr);
      });

      window.addEventListener("mouseup", () => {
        isMouseDown = false;
        lastPointerPos = null;
      });

      catHitArea.addEventListener("mousemove", (e) => {
        if (!isMouseDown) return;
        handlePointerMove(e.clientX, e.clientY);
      });

      // è§¦æ‘¸äº‹ä»¶ï¼ˆç§»åŠ¨ç«¯ï¼‰
      catHitArea.addEventListener(
        "touchstart",
        (e) => {
          if (e.touches.length > 0) {
            const t = e.touches[0];
            lastPointerPos = { x: t.clientX, y: t.clientY };
            revealProgressBar();
            softShakeCat();
            playSafe(audioPurr);
          }
        },
        { passive: true }
      );

      catHitArea.addEventListener(
        "touchmove",
        (e) => {
          if (e.touches.length > 0) {
            const t = e.touches[0];
            handlePointerMove(t.clientX, t.clientY);
          }
        },
        { passive: true }
      );

      catHitArea.addEventListener(
        "touchend",
        () => {
          lastPointerPos = null;
        },
        { passive: true }
      );

      // å…³é—­ç­”æ¡ˆå¡ç‰‡ï¼ˆç‚¹å‡»æŒ‰é’®æˆ–ä»»æ„é®ç½©åŒºåŸŸï¼‰
      answerDismiss.addEventListener("click", revealDetail);
      answerCard.addEventListener("click", hideAnswerCard);
      if (answerCardInner) {
        answerCardInner.addEventListener("click", (e) => e.stopPropagation());
      }

      // åˆå§‹çŠ¶æ€
      setRandomCatScene();
      setEnergy(0);
    </script>
  </body>
</html>

